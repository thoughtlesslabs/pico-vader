pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
	make_player()
	s=1
	ss=1
	buildings={}
	vaderx = 10
	vadery = 90
	vflipx = false
	vsprite={7,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,11,11,11}
	sp = 1
	swingcool = 10
end

function _update60()
	move_vader(p.x,p.y)
	
	p.dy += 0.2

	if btn(0) then
		p.flipx = true
		p.dx = -1
	end
	if btn(1) then
		p.flipx = false
		p.dx = 1
	end
	
	if btnp(2) then
		if not p.jumping then
			p.dy = -4
			p.jumping = true
		end
	end
		
	if btnp(4) then
		s=1
		p.swinging = true
		timer = 5
	end
	
	if p.swinging then
		if timer < 0 then
			if ss <= #p.sprites[s] then
				ss +=1
				timer = 5
			end
		elseif ss == #p.sprites[s] then
				ss = 1
				p.swinging = false	
		end
		timer -=1.25
	end
	
	if not p.jumping then
		p.dx = p.dx/1.15
	end
	
	p.x += p.dx
	p.y += p.dy
	
	p.x = mid(0,p.x,112)
	p.y = mid(8,p.y,90)
	
	if p.y > 89 then
		p.jumping = false
	end
	
	if abs(p.dx) < 0.05 then
		p.dx = 0 
	end
end

function _draw()
	cls(15)
	pal()
	drawbackground()
	draw_character()
	print(debug)
end

function drawbackground()
	cls(12)
	palt(0,false)
	palt(13,true)
	fillp()
	rectfill(0,0,127,80,12)
	circfill(62,325,250,9)
	fillp(0b101000010010000.1)
	palt(0,true)
 spr(128,25,48,10,4)
 pal()
	rectfill(0,60,127,82,12)
	fillp()
	circfill(10,40,20,7)
	circfill(60,40,5,7)
end

function draw_character()
	palt(0,false)
	palt(7,true)
	spr(p.sprites[s][ss],p.x,p.y,2,2,p.flipx,p.flipy)
	spr(vsprite[sp],vaderx,vadery,2,2,vflipx)
	debug=sp
end

function make_player()
	p = {}
	p.x = 50
	p.y = 50
	p.dx =0
	p.dy =0
	p.flipx = false
	p.flipy = false
	p.jumping = false
	p.swinging = false
	p.sprites={{1,3,3,5,5,3,3},{33,33,35,35,33}}
end

function move_vader(mx,my)
	local speed,angle,dx,dy
	
	speed = 0.5
	--	
	dx = mx - vaderx
	
	-- set direction	
	angle = atan2(dx,dy)
	
	
	-- face vader to char
	if angle == 0 then
		vflipx = false
	elseif angle == 0.5 then
		vflipx = true
	end
	
	-- stop vader from getting
	-- too close to char
	if abs(dx) < 10 then
		swingcool -=1
		vaderx = vaderx
		if sp < #vsprite and vadery == p.y then
			if swingcool <0 then
				sp += 1
			end
		elseif sp == #vsprite then
			sp = 1
			swingcool = 100
		end
	else
		vaderx += cos(angle)*speed
		sp = 1
	end
end
-->8
-- to do list

--add light effects when saber
--hits an object
--
--walking movement in feet
--
--sound effects
--
--open and close lightsaber
--background with planets
__gfx__
00000000777777777777777777777777777777777777777777777777777777777777777777777777777777777777888288777777000000000000000000000000
00000000777777809777777777777780077777777777778807777777777777111777777777777711177777777888881112888777000000000000000000000000
00700700777778980777777777777899877777777777788987777777777771000177778787777100017777777782210001828877000000000000000000000000
00077000777778088777777777777880877777777777788087777777777710000077788788771000007777777778100000822877000000000000000000000000
00077000777778808777778777777888077777777777788807777777777710011077887778871001107777777777100000082877000000000000000000000000
00700700777777808777788777777780877777777777778807777777777710010078877777881001007777777777100000088877000000000000000000000000
00000000777700888777887777777788877777877777778887777787777000000188777777780000017777777770000000088877000000000000000000000000
00000000777700000078877777778000007778287777700000777887777770100887777777788010007777777777000000888877000000000000000000000000
00000000777700000588777777780000017788287777000001778877777710008877777777778800100777777777788000888777000000000000000000000000
00000000777001005507777777820100101188287777010010118777777100058077777777710885100777777777000888828777000000000000000000000000
00000000777001055007777777220100000282277777010000007777771001055177777777100155000777777770888888228777000000000000000000000000
00000000777708551007777778282000008282877777800000077777771000002977777777100000000777777771022288877777000000000000000000000000
00000000777788001077777778288000128822877778800010777777710011018577777771001101007777777701018228877777000000000000000000000000
00000000777880100077777778887010888228777788701000777777710010000177777771001000017777777701010000777777000000000000000000000000
00000000778801100007777778870018208887777887701001077777707700000107777770770000010777777700001100777777000000000000000000000000
00000000788000000007777777770000111077777777700001007777777710170007777777771017000777777771000110077777000000000000000000000000
00000000777777777777777777777780977777777777777777777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777777777777777777898077777777777777809777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777777777777777777808877777777777778980777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777780977777777777880877777877777778088777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777898077777777777780877778877778778808777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777808877777777770088877788777778877808777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777880877777877770000007887777777800888777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777780877778877770000058877777777700000077777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777770088877788777700100550777777777770000177777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777770000007887777700105500777777777771001007777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777770000018877777770055100777777777771000007777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777700100100777777770800107777777777700000000777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777700100100777777778800007777777777700001000777000000000000000000000000000000000000000000000000000000000000000000000000
00000000777770000100777777788010007777777777700100078877000000000000000000000000000000000000000000000000000000000000000000000000
00000000777880110000777777880110000777777777000100007887000000000000000000000000000000000000000000000000000000000000000000000000
00000000778800000000777778800000000777777777000000007788000000000000000000000000000000000000000000000000000000000000000000000000
dddddddddddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddddddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd55ffffddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddd55ffff7fdddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddd5fffffff7fddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dd55ffffffffffdd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d5fffffffffffffd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d55ffffffffffffd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55ffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5ffffffffff00ff70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55ff7f0000f50ff70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5ffff75550f50f7f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55ffff5550fffff70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f55fff5550fff55f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5f5fff5550ff7ff50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055000500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055055000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055550000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000055555000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000500055000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000055055000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000055000000000055555000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000055555555500000555550000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000005555555555555505555000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000055555555555555555055000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000005555555555555555555555000000000000000000055555500000000000000000000000000000000000000000000000000000000000
00000000000000000000055555555555555555555555000000000000000000555555550000000000000000000000000000000000000000000000000000000000
00000000000000000000555555555555555555555555000000000000000005555555555000000000000000000000000000000000000000000000000000000000
00000000000000000005555555555555555555555555500000000000000055555555555500000000000000000000000000000000000000000000000000000000
00000005555550000005555555555555555555555555550000000000000555555555555550000000000000000000000000000000000000000000000000000000
00000555555555500055555555555555555555555555550000000000000555555555555550000000000000000000000000000000000000000000000000000000
00005555555555550055555555555555555555555555555000000000000555555555555550000000000000000000000000000000000000000000000000000000
00055555555555555055555555555555555555555555555000000000000555555555555550000000000000000000000000000000000000000000000000000000
00555555555555555555555555555555555555555555555000000000555555555555555555550000000000000000000000000000000000000000000000000000
05555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
05555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000005555555555555555555555000000000000000000000000000000000000000000000000000
